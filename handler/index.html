<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Handler - The Things Network</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>
        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="..">The Things Network</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="..">Overview</a>
                </li>
            
            
            
                <li >
                    <a href="../common/">Common</a>
                </li>
            
            
            
                <li >
                    <a href="../router/">Router</a>
                </li>
            
            
            
                <li >
                    <a href="../broker/">Broker</a>
                </li>
            
            
            
                <li >
                    <a href="../networkserver/">Network Server</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">Handler</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../networkserver/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li class="disabled">
                    <a rel="prev" >
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    
    <table>
        <tr><td>version:</td><td>1.0.0</td></tr>
        <tr><td>status:</td><td>draft</td></tr>
        <tr><td>lead:</td><td>Matthias Benkort</td></tr>
        <tr><td>collaborators:</td><td>
            
                Johan Stokking<br/>
            
                Hylke Visser<br/>
            
                Thomas Telkamp<br/>
            
        </td></tr>
    </table>

    <hr/>
    

    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#handler">Handler</a></li>
        
            <li><a href="#role">Role</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="handler">Handler</h1>
<h2 id="role">Role</h2>
<p>The handler is the last buffer between the network and the app. Thus, it is in charge of doing
anything private to the app. Handlers are a bunch of recurrent services that any app will need
to interact with the network. Instead of having to implement all the mechanisms described
below, applications can just trust a given handler to manipulate their secret keys and handle
the overhead logic of packet encryption, registration and decryption. </p>
<p>This raises nevertheless an important trust issue. The network is open, meaning that anyone can
join it and contribute with their own servers. The code is thereby accessible such that it
simplifies the installation of a component. However, The Things Network isn't a certificate
authority of any kind, meaning that we cannot ensure that a given broker implement a code
strictly identical to the one provided by the foundation. The question is still open and
discussion are welcomed. </p>
<p>Also, for the rest of this document, we'll described handlers as a completely independant
component that interacts with both a broker and an application. In practice, handlers could be
partially merged with an application or be provided as a cloud service. This does not change
anything for the network point of view as long as handlers remain compliant with the uplink
interface detailed below. The following proposal states one kind of handler provided in the
first version of the network. Different implementations with different mechanisms could exist,
however, this document only refers to one type. </p>
<p>Having said that, the handler is supposed to perform the following actions:</p>
<ul>
<li>Register an application and a bunch of personnalized devices and DevEUI</li>
<li>Register to a broker (with an application EUIs, </li>
<li>Receive and decrypt incoming packets from a broker with deduplication mechanisms</li>
<li>Handle join request (generate NwkSKey, AppSKey, AppNounce...)</li>
<li>Forward packet's payload to its application</li>
<li>Forward response from applications to brokers</li>
</ul>
<p>Again, this components act as a relay between some recipients. Let's detail in the
communication in two parts and distinguish uplink communication from application requests. We
won't talk about downlink communication because the handler materalize the end of the chain
and, the downlink communication is part of the uplink process for the handler point of view.
The handler is managing the communication back and forth between the network and the
application. However, the application can still operate on a configuration level with the
broker (so far, only to register / unregister itself). </p>
<h3 id="handler-configuration">Handler configuration</h3>
<p>Intially, the network is completely unaware of any application meaning that any messages
emitted by gateways won't go further than routers. However, at any time, an application can
connect the network by interacting with a handler. </p>
<p>To join the network, the application has to provide several private data such as:</p>
<ul>
<li>An application id</li>
<li>A secret application key</li>
<li>A list of known DevEUI </li>
<li>Way back information (protocol + server)</li>
</ul>
<p>With those pieces of information, the handler would be in charge of all the trafic towards the
given application. An application could possibly updates the list of nodes or the communication
protocol later. </p>
<p>There is no reason for a handler to reject an application join request for the moment however,
the handler will still reply with a positive response to the willing application. </p>
<h3 id="uplink-communication">Uplink communication</h3>
<p>We'll call uplink communication any communication coming from brokers. Uplink communications
could be either data coming from a node or a join request.  </p>
<p>Because of the network architecture, several duplicates of the same messages could arrive to
the handler. We assume that all of those messages are arriving all in the same time. The
handler will then have to deduplicate all messages if necessary and proceed to a geolocation
based on the information provided by the gateways. The handler also has an access to the
application secret key, Thus, it could decrypt the data and forward them to the application. </p></div>
        </div>

        
        <div id="disqus_thread" class="container"></div>
        <script type="text/javascript">
            var disqus_shortname = 'thethingsnetwork';
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script src="../js/base.js"></script>
    </body>
</html>